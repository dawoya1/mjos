# MJOS ç›‘æ§ç³»ç»Ÿé…ç½®æŒ‡å—

> **æœ€åæ›´æ–°æ—¶é—´**: 2025-07-17 09:35:20 UTC  
> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0.0  
> **æ›´æ–°å†…å®¹**: åˆ›å»ºå®Œæ•´çš„ç›‘æ§ç³»ç»Ÿé…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä¸ºMJOSç³»ç»Ÿé…ç½®å®Œæ•´çš„ç›‘æ§ä½“ç³»ï¼ŒåŒ…æ‹¬æŒ‡æ ‡æ”¶é›†ã€æ—¥å¿—èšåˆã€å‘Šè­¦é€šçŸ¥å’Œå¯è§†åŒ–å±•ç¤ºã€‚

## ğŸ—ï¸ ç›‘æ§æ¶æ„

### ç›‘æ§ä½“ç³»æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¯è§†åŒ–å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Grafana   â”‚  â”‚  Kibana     â”‚  â”‚   è‡ªå®šä¹‰     â”‚     â”‚
â”‚  â”‚   ä»ªè¡¨æ¿     â”‚  â”‚   æ—¥å¿—      â”‚  â”‚   ç›‘æ§é¡µé¢   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Prometheus  â”‚  â”‚Elasticsearchâ”‚  â”‚   InfluxDB  â”‚     â”‚
â”‚  â”‚   æ—¶åºæ•°æ®   â”‚  â”‚   æ—¥å¿—æ•°æ®   â”‚  â”‚   æ€§èƒ½æ•°æ®   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®æ”¶é›†å±‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Node      â”‚  â”‚  Filebeat   â”‚  â”‚   è‡ªå®šä¹‰     â”‚     â”‚
â”‚  â”‚  Exporter   â”‚  â”‚   æ—¥å¿—æ”¶é›†   â”‚  â”‚   æŒ‡æ ‡æ”¶é›†   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MJOSåº”ç”¨å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ MJOS App 1  â”‚  â”‚ MJOS App 2  â”‚  â”‚ MJOS App 3  â”‚     â”‚
â”‚  â”‚   æŒ‡æ ‡æš´éœ²   â”‚  â”‚   æ—¥å¿—è¾“å‡º   â”‚  â”‚   å¥åº·æ£€æŸ¥   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Prometheusç›‘æ§é…ç½®

### Prometheusé…ç½®æ–‡ä»¶
```yaml
# monitoring/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "rules/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # MJOSåº”ç”¨ç›‘æ§
  - job_name: 'mjos-app'
    static_configs:
      - targets: ['mjos-app:9090']
    metrics_path: '/metrics'
    scrape_interval: 10s
    scrape_timeout: 5s

  # Node.jsè¿›ç¨‹ç›‘æ§
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # PostgreSQLç›‘æ§
  - job_name: 'postgres-exporter'
    static_configs:
      - targets: ['postgres-exporter:9187']

  # Redisç›‘æ§
  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['redis-exporter:9121']

  # Nginxç›‘æ§
  - job_name: 'nginx-exporter'
    static_configs:
      - targets: ['nginx-exporter:9113']

  # è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡
  - job_name: 'mjos-business-metrics'
    static_configs:
      - targets: ['mjos-app:9091']
    metrics_path: '/business-metrics'
```

### å‘Šè­¦è§„åˆ™é…ç½®
```yaml
# monitoring/rules/mjos-alerts.yml
groups:
  - name: mjos-application
    rules:
      # åº”ç”¨å¯ç”¨æ€§å‘Šè­¦
      - alert: MJOSAppDown
        expr: up{job="mjos-app"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "MJOSåº”ç”¨å®ä¾‹ä¸‹çº¿"
          description: "MJOSåº”ç”¨å®ä¾‹ {{ $labels.instance }} å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ"

      # é«˜é”™è¯¯ç‡å‘Šè­¦
      - alert: MJOSHighErrorRate
        expr: rate(mjos_http_requests_total{status=~"5.."}[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "MJOSåº”ç”¨é”™è¯¯ç‡è¿‡é«˜"
          description: "MJOSåº”ç”¨é”™è¯¯ç‡è¶…è¿‡10%ï¼Œå½“å‰å€¼: {{ $value }}"

      # é«˜å“åº”æ—¶é—´å‘Šè­¦
      - alert: MJOSHighLatency
        expr: histogram_quantile(0.95, rate(mjos_http_request_duration_seconds_bucket[5m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MJOSåº”ç”¨å“åº”æ—¶é—´è¿‡é•¿"
          description: "MJOSåº”ç”¨95%å“åº”æ—¶é—´è¶…è¿‡1ç§’ï¼Œå½“å‰å€¼: {{ $value }}s"

      # å†…å­˜ä½¿ç”¨å‘Šè­¦
      - alert: MJOSHighMemoryUsage
        expr: (mjos_memory_usage_bytes / mjos_memory_limit_bytes) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MJOSåº”ç”¨å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "MJOSåº”ç”¨å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼: {{ $value }}%"

      # CPUä½¿ç”¨å‘Šè­¦
      - alert: MJOSHighCPUUsage
        expr: rate(mjos_cpu_usage_seconds_total[5m]) * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "MJOSåº”ç”¨CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "MJOSåº”ç”¨CPUä½¿ç”¨ç‡è¶…è¿‡80%ï¼Œå½“å‰å€¼: {{ $value }}%"

  - name: mjos-database
    rules:
      # æ•°æ®åº“è¿æ¥å‘Šè­¦
      - alert: PostgreSQLDown
        expr: up{job="postgres-exporter"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "PostgreSQLæ•°æ®åº“ä¸‹çº¿"
          description: "PostgreSQLæ•°æ®åº“å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ"

      # æ•°æ®åº“è¿æ¥æ•°å‘Šè­¦
      - alert: PostgreSQLTooManyConnections
        expr: pg_stat_database_numbackends / pg_settings_max_connections * 100 > 80
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "PostgreSQLè¿æ¥æ•°è¿‡å¤š"
          description: "PostgreSQLè¿æ¥æ•°è¶…è¿‡80%ï¼Œå½“å‰å€¼: {{ $value }}%"

  - name: mjos-redis
    rules:
      # Rediså¯ç”¨æ€§å‘Šè­¦
      - alert: RedisDown
        expr: up{job="redis-exporter"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "RedisæœåŠ¡ä¸‹çº¿"
          description: "RedisæœåŠ¡å·²ä¸‹çº¿è¶…è¿‡1åˆ†é’Ÿ"

      # Rediså†…å­˜ä½¿ç”¨å‘Šè­¦
      - alert: RedisHighMemoryUsage
        expr: (redis_memory_used_bytes / redis_memory_max_bytes) * 100 > 90
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "Rediså†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%ï¼Œå½“å‰å€¼: {{ $value }}%"
```

### Alertmanageré…ç½®
```yaml
# monitoring/alertmanager.yml
global:
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@mjos.com'
  smtp_auth_username: 'alerts@mjos.com'
  smtp_auth_password: 'your_email_password'

route:
  group_by: ['alertname']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'web.hook'
  routes:
    - match:
        severity: critical
      receiver: 'critical-alerts'
    - match:
        severity: warning
      receiver: 'warning-alerts'

receivers:
  - name: 'web.hook'
    webhook_configs:
      - url: 'http://webhook-service:5001/webhook'

  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@mjos.com'
        subject: 'ğŸš¨ MJOSå…³é”®å‘Šè­¦: {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          æ—¶é—´: {{ .StartsAt }}
          {{ end }}
    webhook_configs:
      - url: 'http://webhook-service:5001/critical'

  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@mjos.com'
        subject: 'âš ï¸ MJOSè­¦å‘Šå‘Šè­¦: {{ .GroupLabels.alertname }}'
        body: |
          {{ range .Alerts }}
          å‘Šè­¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          æ—¶é—´: {{ .StartsAt }}
          {{ end }}

inhibit_rules:
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'instance']
```

## ğŸ“ˆ Grafanaä»ªè¡¨æ¿é…ç½®

### æ•°æ®æºé…ç½®
```yaml
# monitoring/grafana/datasources.yml
apiVersion: 1

datasources:
  - name: Prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true

  - name: Elasticsearch
    type: elasticsearch
    access: proxy
    url: http://elasticsearch:9200
    database: mjos-logs-*
    timeField: "@timestamp"

  - name: InfluxDB
    type: influxdb
    access: proxy
    url: http://influxdb:8086
    database: mjos_metrics
```

### ä»ªè¡¨æ¿é…ç½®
```json
{
  "dashboard": {
    "title": "MJOSç³»ç»Ÿç›‘æ§ä»ªè¡¨æ¿",
    "tags": ["mjos", "monitoring"],
    "timezone": "browser",
    "panels": [
      {
        "title": "åº”ç”¨çŠ¶æ€æ¦‚è§ˆ",
        "type": "stat",
        "targets": [
          {
            "expr": "up{job=\"mjos-app\"}",
            "legendFormat": "åº”ç”¨å®ä¾‹çŠ¶æ€"
          }
        ],
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "steps": [
                {"color": "red", "value": 0},
                {"color": "green", "value": 1}
              ]
            }
          }
        }
      },
      {
        "title": "è¯·æ±‚é€Ÿç‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(mjos_http_requests_total[5m])",
            "legendFormat": "{{method}} {{status}}"
          }
        ]
      },
      {
        "title": "å“åº”æ—¶é—´åˆ†å¸ƒ",
        "type": "heatmap",
        "targets": [
          {
            "expr": "rate(mjos_http_request_duration_seconds_bucket[5m])",
            "legendFormat": "{{le}}"
          }
        ]
      },
      {
        "title": "å†…å­˜ä½¿ç”¨æƒ…å†µ",
        "type": "graph",
        "targets": [
          {
            "expr": "mjos_memory_usage_bytes",
            "legendFormat": "å·²ä½¿ç”¨å†…å­˜"
          },
          {
            "expr": "mjos_memory_limit_bytes",
            "legendFormat": "å†…å­˜é™åˆ¶"
          }
        ]
      },
      {
        "title": "æ•°æ®åº“è¿æ¥æ± ",
        "type": "graph",
        "targets": [
          {
            "expr": "mjos_db_connections_active",
            "legendFormat": "æ´»è·ƒè¿æ¥"
          },
          {
            "expr": "mjos_db_connections_idle",
            "legendFormat": "ç©ºé—²è¿æ¥"
          }
        ]
      }
    ]
  }
}
```

## ğŸ“ æ—¥å¿—ç›‘æ§é…ç½®

### ELK Stacké…ç½®

#### Elasticsearché…ç½®
```yaml
# monitoring/elasticsearch.yml
cluster.name: mjos-logs
node.name: elasticsearch-node-1
network.host: 0.0.0.0
discovery.type: single-node
xpack.security.enabled: false
xpack.monitoring.collection.enabled: true
```

#### Logstashé…ç½®
```ruby
# monitoring/logstash.conf
input {
  beats {
    port => 5044
  }
}

filter {
  if [fields][service] == "mjos" {
    json {
      source => "message"
    }
    
    date {
      match => [ "timestamp", "ISO8601" ]
    }
    
    mutate {
      add_field => { "service" => "mjos" }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "mjos-logs-%{+YYYY.MM.dd}"
  }
  
  stdout {
    codec => rubydebug
  }
}
```

#### Filebeaté…ç½®
```yaml
# monitoring/filebeat.yml
filebeat.inputs:
  - type: log
    enabled: true
    paths:
      - /var/log/mjos/*.log
    fields:
      service: mjos
    fields_under_root: true
    multiline.pattern: '^\d{4}-\d{2}-\d{2}'
    multiline.negate: true
    multiline.match: after

output.logstash:
  hosts: ["logstash:5044"]

processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
```

## ğŸ”” å‘Šè­¦é€šçŸ¥é…ç½®

### é’‰é’‰æœºå™¨äººé€šçŸ¥
```javascript
// monitoring/webhook-service.js
const express = require('express');
const axios = require('axios');

const app = express();
app.use(express.json());

// é’‰é’‰æœºå™¨äººWebhook
const DINGTALK_WEBHOOK = 'https://oapi.dingtalk.com/robot/send?access_token=YOUR_TOKEN';

app.post('/webhook', async (req, res) => {
  const alerts = req.body.alerts;
  
  for (const alert of alerts) {
    const message = {
      msgtype: 'markdown',
      markdown: {
        title: `MJOSå‘Šè­¦: ${alert.labels.alertname}`,
        text: `
### ${alert.annotations.summary}

**å‘Šè­¦çº§åˆ«**: ${alert.labels.severity}
**å‘Šè­¦æè¿°**: ${alert.annotations.description}
**å‘Šè­¦æ—¶é—´**: ${alert.startsAt}
**å®ä¾‹**: ${alert.labels.instance}

[æŸ¥çœ‹è¯¦æƒ…](http://grafana.mjos.com/dashboard)
        `
      }
    };
    
    try {
      await axios.post(DINGTALK_WEBHOOK, message);
    } catch (error) {
      console.error('å‘é€é’‰é’‰é€šçŸ¥å¤±è´¥:', error);
    }
  }
  
  res.status(200).send('OK');
});

app.listen(5001, () => {
  console.log('WebhookæœåŠ¡å¯åŠ¨åœ¨ç«¯å£5001');
});
```

### ä¼ä¸šå¾®ä¿¡é€šçŸ¥
```javascript
// monitoring/wechat-webhook.js
const express = require('express');
const axios = require('axios');

const app = express();
app.use(express.json());

const WECHAT_WEBHOOK = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=YOUR_KEY';

app.post('/wechat', async (req, res) => {
  const alerts = req.body.alerts;
  
  for (const alert of alerts) {
    const message = {
      msgtype: 'markdown',
      markdown: {
        content: `
## MJOSç³»ç»Ÿå‘Šè­¦

**å‘Šè­¦åç§°**: ${alert.labels.alertname}
**å‘Šè­¦çº§åˆ«**: <font color="warning">${alert.labels.severity}</font>
**å‘Šè­¦æè¿°**: ${alert.annotations.description}
**å‘Šè­¦æ—¶é—´**: ${alert.startsAt}
**å®ä¾‹åœ°å€**: ${alert.labels.instance}

> è¯·åŠæ—¶å¤„ç†ç›¸å…³é—®é¢˜
        `
      }
    };
    
    try {
      await axios.post(WECHAT_WEBHOOK, message);
    } catch (error) {
      console.error('å‘é€ä¼ä¸šå¾®ä¿¡é€šçŸ¥å¤±è´¥:', error);
    }
  }
  
  res.status(200).send('OK');
});

app.listen(5002, () => {
  console.log('ä¼ä¸šå¾®ä¿¡WebhookæœåŠ¡å¯åŠ¨åœ¨ç«¯å£5002');
});
```

## ğŸ³ Docker Composeç›‘æ§æ ˆ

```yaml
# monitoring/docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: mjos-prometheus
    restart: unless-stopped
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - ./rules:/etc/prometheus/rules
      - prometheus-data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/etc/prometheus/console_libraries'
      - '--web.console.templates=/etc/prometheus/consoles'
      - '--web.enable-lifecycle'

  grafana:
    image: grafana/grafana:latest
    container_name: mjos-grafana
    restart: unless-stopped
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin123
    volumes:
      - grafana-data:/var/lib/grafana
      - ./grafana/datasources.yml:/etc/grafana/provisioning/datasources/datasources.yml

  alertmanager:
    image: prom/alertmanager:latest
    container_name: mjos-alertmanager
    restart: unless-stopped
    ports:
      - "9093:9093"
    volumes:
      - ./alertmanager.yml:/etc/alertmanager/alertmanager.yml

  node-exporter:
    image: prom/node-exporter:latest
    container_name: mjos-node-exporter
    restart: unless-stopped
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc)($$|/)'

volumes:
  prometheus-data:
  grafana-data:
```

## ğŸ“‹ ç›‘æ§æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] Prometheusé…ç½®æ–‡ä»¶æ­£ç¡®
- [ ] å‘Šè­¦è§„åˆ™é…ç½®å®Œæ•´
- [ ] Grafanaæ•°æ®æºé…ç½®
- [ ] é€šçŸ¥æ¸ é“æµ‹è¯•é€šè¿‡
- [ ] å­˜å‚¨ç©ºé—´å……è¶³

### è¿è¡Œæ—¶ç›‘æ§
- [ ] æ‰€æœ‰ç›®æ ‡æ­£å¸¸é‡‡é›†
- [ ] å‘Šè­¦è§„åˆ™æ­£å¸¸è§¦å‘
- [ ] ä»ªè¡¨æ¿æ•°æ®æ­£å¸¸æ˜¾ç¤º
- [ ] é€šçŸ¥æ­£å¸¸å‘é€
- [ ] æ—¥å¿—æ­£å¸¸æ”¶é›†

### å®šæœŸç»´æŠ¤
- [ ] æ¸…ç†è¿‡æœŸæ•°æ®
- [ ] æ›´æ–°ç›‘æ§è§„åˆ™
- [ ] ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- [ ] å¤‡ä»½ç›‘æ§é…ç½®
- [ ] æµ‹è¯•ç¾éš¾æ¢å¤

---

**ç»´æŠ¤å›¢é˜Ÿ**: MJOSç›‘æ§å›¢é˜Ÿ  
**æ›´æ–°é¢‘ç‡**: æ¯æœˆä¸€æ¬¡  
**æŠ€æœ¯æ”¯æŒ**: monitoring@mjos.com
